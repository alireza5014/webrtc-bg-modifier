class t{constructor(){this.scriptLoaded=!1,this.segmentation=null,this.url=null,this.color=null,this.stream=null,this.brightness=1,this.contrast=1,this.grayScale=!1,this.blur=0,this.videoElement=document.createElement("video"),this.canvasElement=document.createElement("canvas")}setBrightness(t){return this.brightness=+t,this}setContrast(t){return this.contrast=+t,this}setBlur(t){return this.blur=+t+"px",this}setGrayScale(t){return this.grayScale=t,this}setStream(t){return this.stream=t,this}setBackgroundImage(t){return this.url=t,this.color=null,this}setBackgroundColor(t){return this.color=t,this}async appendScriptToHead(t,{async:e=!0,defer:a=!1,callback:i=()=>{}}={}){var s=this;if(this.scriptLoaded)return void await i();const n=document.createElement("script");n.src=t,n.async=e,n.defer=a,n.onload=async function(){s.scriptLoaded=!0,await i()},n.onerror=()=>console.error(`Failed to load script: ${t}`),document.head.appendChild(n)}applyBackgroundImage(t,e,a){const{videoWidth:i,videoHeight:s}=this.videoElement;t.clearRect(0,0,i,s),t.filter=`brightness(${this.brightness}) contrast(${this.contrast}) blur(${this.blur})`,t.drawImage(e.segmentationMask,0,0,i,s),t.globalCompositeOperation="source-out",t.drawImage(a||this.videoElement,0,0,i,s),t.globalCompositeOperation="destination-atop",t.filter=`brightness(${this.brightness}) contrast(${this.contrast})`,t.drawImage(e.image,0,0,i,s)}applyBrightnessAndContrast(t){t.filter=`brightness(${this.brightness}) contrast(${this.contrast}) `}applyBackgroundColor(t,e){const{videoWidth:a,videoHeight:i}=this.videoElement;t.clearRect(0,0,a,i),t.drawImage(e.segmentationMask,0,0,a,i),t.globalCompositeOperation="source-out",t.fillStyle=this.color,t.fillRect(0,0,a,i),t.globalCompositeOperation="destination-atop",t.drawImage(e.image,0,0,a,i)}applyGrayscale(t){const{videoWidth:e,videoHeight:a}=this.videoElement,i=t.getImageData(0,0,e,a),s=i.data;for(let t=0;t<s.length;t+=4)s[t]=s[t+1]=s[t+2]=(s[t]+s[t+1]+s[t+2])/3;t.putImageData(i,0,0)}backgroundList(){return{color:[{value:"#F9C0AB",alt:"#F9C0AB"},{value:"#F4E0AF",alt:"#F4E0AF"},{value:"#A8CD89",alt:"#A8CD89"},{value:"#355F2E",alt:"#355F2E"}],image:[{value:"img/1.jpg",alt:"Image 1"},{value:"img/2.jpg",alt:"Image 2"},{value:"img/3.jpg",alt:"Image 3"}]}}async setupSegmentation(t,e){var a=this;await this.appendScriptToHead("https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js",{async:!0,callback:async function(){a.segmentation||(a.segmentation=new SelfieSegmentation({locateFile:t=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${t}`})),a.segmentation.setOptions({modelSelection:1}),a.segmentation.onResults(i=>{a.color?(a.applyBackgroundColor(t,i),a.applyBrightnessAndContrast(t)):a.applyBackgroundImage(t,i,e),a.grayScale&&a.applyGrayscale(t)}),await a.segmentation.initialize(),await async function t(){await a.segmentation.send({image:a.videoElement}),requestAnimationFrame(t)}()}})}async changeBackground(){this.videoElement.srcObject=this.stream,this.videoElement.play(),await new Promise(t=>this.videoElement.onloadeddata=t);const{videoWidth:t,videoHeight:e}=this.videoElement;this.canvasElement.width=t,this.canvasElement.height=e;const a=this.canvasElement.getContext("2d");if(!(this.url||this.grayScale||1!==this.brightness||1!==this.contrast||this.color||this.blur))return this.stream;let i=null;return this.url&&(i=new Image,i.src=this.url,await new Promise(t=>i.onload=t)),await this.setupSegmentation(a,i),this.canvasElement.captureStream(30)}}export{t as default};
//# sourceMappingURL=index.modern.js.map
