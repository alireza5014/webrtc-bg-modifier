<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaPipe Body Segmentation</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/body_segmentation"></script>
</head>
<body>
<h2>MediaPipe Body Segmentation</h2>
<canvas id="canvas"></canvas>
<script>
    // Setup the video capture
    async function setupVideo() {
        const video = document.createElement('video');
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;

        // Wait for the video to start playing
        video.onloadedmetadata = () => {
            video.play();
            processVideoFrame(video);
        };
    }

    // Process each video frame
    async function processVideoFrame(video) {
        const segmentation = await bodySegmentation.send({image: video});

        // Apply the segmentation result (mask) on the canvas
        applySegmentationResult(segmentation, video);

        // Request the next frame
        requestAnimationFrame(() => processVideoFrame(video));
    }

    // Apply segmentation mask on the canvas
    function applySegmentationResult(segmentation, video) {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Set the canvas size to match the video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // Draw the segmentation result on the canvas
        ctx.putImageData(segmentation.segmentationMask, 0, 0);

        // Optionally apply effects or other manipulations with the segmentation mask
        // For example, you can use the segmentation mask to remove the background
    }

    // Initialize MediaPipe Body Segmentation model
    const bodySegmentation = new window.MediaPipe.BodySegmentation.BodySegmentation();
    bodySegmentation.setOptions({
        modelSelection: 1,  // 1 means use the full-body segmentation model
        outputStride: 16,
        segmentBody: true,
    });

    bodySegmentation.onResults((results) => {
        // The segmentation mask is available in results.segmentationMask
        console.log('Segmentation mask generated');
    });

    // Start everything
    async function start() {
        await setupVideo(); // Start capturing the video
    }

    start();  // Call to start the process
</script>
</body>
</html>
